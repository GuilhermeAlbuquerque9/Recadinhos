<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Recadinhos‚Ñ¢ ‚Äî Postagens</title>
</head>
<body>

  <table>
    <tr>
      <h1><strong>Recadinhos‚Ñ¢</strong></h1>
    </tr>
    <tr>
      <td>
        [ <a href="index.html">üè† In√≠cio</a> ]
        [ <a href="Sobre.html">üìÑ Sobre</a> ]
        [ <a href="Criar_conta.html">üôÇ Criar conta</a> ]
        [ <a href="Postagens.html">üìß Postagens</a> ]
        [ <a href="Sair.html">‚ùå Sair</a> ]
      </td>
    </tr>
  </table>

  <h1>Mural de Recadinhos</h1>

  <form id="formRecadinho">
    <label for="autor">Usu√°rio:</label><br>
    <input type="text" id="autor" name="autor" maxlength="20" required readonly><br><br>

    <label for="mensagem">Seu recadinho:</label><br>
    <textarea id="mensagem" name="mensagem" rows="5" cols="40" placeholder="Escreva algo... Voc√™ pode mencionar @nomes aqui!" required></textarea><br><br>

    <input type="submit" value="Publicar Recadinho">
    <input type="reset" value="Limpar">
  </form>

  <hr>

  <h2>üì¨ Recadinhos pra voc√™</h2>
  <ul id="listaPraVoce"></ul>

  <h2>üåê Recadinhos p√∫blicos</h2>
  <ul id="listaRecados"></ul>

  <script>
    // üîó COLE SUA API AQUI!
    const API_URL = "https://script.google.com/macros/s/AKfycbxFfDNxXYIRRE5JXTqro_09yMapNPyosCLKeSfeuN1KfXtK_Ez1XDJBMYwlNmJlNRizYA/exec";

    // Carregar usu√°rio logado
    const usuarioAtual = localStorage.getItem("usuario");
    if (!usuarioAtual) {
      alert("Voc√™ precisa estar logado para ver os recadinhos!");
      window.location.href = "Criar_conta.html";
    } else {
      document.getElementById("autor").value = usuarioAtual;
    }

    // Enviar recadinho
    document.getElementById("formRecadinho").addEventListener("submit", async (e) => {
      e.preventDefault();

      const autor = document.getElementById("autor").value.trim();
      const mensagem = document.getElementById("mensagem").value.trim();

      if (!mensagem) {
        alert("Digite um recadinho!");
        return;
      }

      const dados = {
        tipo: "novoRecado",
        autor,
        mensagem,
        data: new Date().toLocaleString()
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(dados)
        });
        const txt = await res.text();
        alert("Recadinho enviado com sucesso!");
        document.getElementById("mensagem").value = "";
        carregarRecadinhos();
      } catch (err) {
        alert("Erro ao enviar recadinho!");
        console.error(err);
      }
    });

    // Carregar recadinhos
    async function carregarRecadinhos() {
      document.getElementById("listaRecados").innerHTML = "<li>Carregando recadinhos...</li>";
      document.getElementById("listaPraVoce").innerHTML = "";

      try {
        const res = await fetch(API_URL + "?tipo=recadinhos");
        const recadinhos = await res.json();

        const listaPublicos = document.getElementById("listaRecados");
        const listaPrivados = document.getElementById("listaPraVoce");

        listaPublicos.innerHTML = "";
        listaPrivados.innerHTML = "";

        // Mostrar recados
        recadinhos.reverse().forEach(r => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>@${r.autor}</strong>: ${r.mensagem}`;

          // Se mencionar o usu√°rio atual
          if (r.mensagem.includes("@" + usuarioAtual)) {
            listaPrivados.appendChild(li);
          }
          // Se for p√∫blico (sem men√ß√£o)
          else if (!r.mensagem.includes("@")) {
            listaPublicos.appendChild(li);
          }
        });

        if (!listaPublicos.hasChildNodes()) {
          listaPublicos.innerHTML = "<li>Nenhum recadinho p√∫blico ainda.</li>";
        }
        if (!listaPrivados.hasChildNodes()) {
          listaPrivados.innerHTML = "<li>Nenhum recadinho pra voc√™ ainda.</li>";
        }

      } catch (err) {
        console.error("Erro ao carregar recadinhos:", err);
        document.getElementById("listaRecados").innerHTML = "<li>Erro ao carregar recadinhos.</li>";
      }
    }

    carregarRecadinhos();
  </script>

</body>
</html>
